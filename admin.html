<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#1e1b4b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="robots" content="noindex, nofollow">
    <title>å¯¼èˆªç«™ç®¡ç†é¢æ¿</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* Toast åŠ¨ç”» */
        .toast {
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
            }
        }

        /* æ¨¡æ€æ¡†åŠ¨ç”» */
        .modal-backdrop {
            transition: opacity 0.2s ease;
        }

        .modal-content {
            transition: transform 0.2s ease, opacity 0.2s ease;
        }

        .modal-backdrop.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .modal-backdrop.hidden .modal-content {
            transform: scale(0.95);
            opacity: 0;
        }

        /* å¡ç‰‡æ ·å¼ - ä¸å‰å°ä¸€è‡´ */
        .site-card {
            transition: all 0.3s ease;
            cursor: grab;
        }

        .site-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .site-card:active {
            cursor: grabbing;
        }

        /* æ‹–æ‹½ç›¸å…³æ ·å¼ */
        .site-card.dragging {
            opacity: 0.5;
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
        }

        .site-card.drag-over {
            border: 2px dashed #8b5cf6;
            background: rgba(139, 92, 246, 0.1);
        }

        .drop-placeholder {
            border: 2px dashed #8b5cf6;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 1rem;
            min-height: 120px;
        }

        /* å›¾æ ‡å®¹å™¨ */
        .icon-container {
            width: 48px;
            height: 48px;
            min-width: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        /* å¤–éƒ¨é“¾æ¥å›¾æ ‡ */
        .external-icon {
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .site-card:hover .external-icon {
            opacity: 1;
        }

        /* æ“ä½œæŒ‰é’®ç»„ */
        .card-actions {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .site-card:hover .card-actions {
            opacity: 1;
        }

        .card-action-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        /* åˆ†ç±»æ ‡ç­¾é¢œè‰² */
        .category-dot-common {
            background: #a78bfa;
        }

        .category-dot-tier1 {
            background: #3b82f6;
        }

        .category-dot-tier2 {
            background: #14b8a6;
        }

        .category-dot-stable {
            background: #22c55e;
        }

        .category-dot-budget {
            background: #f97316;
        }

        /* ç§»åŠ¨ç«¯å“åº”å¼ */
        @media (max-width: 640px) {
            .btn-group {
                flex-direction: column;
            }

            .btn-group button {
                width: 100%;
            }

            h1 {
                font-size: 1.5rem;
            }

            section {
                padding: 1rem !important;
            }

            .action-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }

            .card-actions {
                opacity: 1;
            }
        }

        /* å®‰å…¨åŒºåŸŸé€‚é… */
        body {
            padding-bottom: env(safe-area-inset-bottom, 0);
        }

        /* è¾“å…¥æ¡†ä¼˜åŒ– */
        input,
        select,
        textarea {
            font-size: 16px;
        }

        /* æ ‡ç­¾é¡µæ ·å¼ */
        .tab-btn {
            transition: all 0.2s ease;
        }

        .tab-btn.active {
            background: rgba(139, 92, 246, 0.2);
            border-color: #8b5cf6;
            color: #a78bfa;
        }

        /* æ‹–æ‹½æç¤º */
        .drag-hint {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 0.6;
            }

            50% {
                opacity: 1;
            }
        }

        /* è‡ªå®šä¹‰ Tooltip - æ‚¬åœå¡ç‰‡æ˜¾ç¤ºå®Œæ•´æè¿° */
        .desc-tooltip {
            position: relative;
        }

        /* å¡ç‰‡æ‚¬åœæ—¶æå‡å±‚çº§ */
        .site-card.desc-tooltip:hover {
            z-index: 50;
        }

        .desc-tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 60px;
            right: 16px;
            top: 100%;
            margin-top: 4px;
            padding: 10px 14px;
            background: rgba(30, 27, 75, 0.95);
            color: #fff;
            font-size: 13px;
            line-height: 1.5;
            border-radius: 10px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.25);
            white-space: normal;
            box-sizing: border-box;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-5px);
            transition: opacity 0.15s ease, transform 0.15s ease, visibility 0.15s;
            pointer-events: none;
        }

        .desc-tooltip:hover::after {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dark .desc-tooltip::after {
            background: rgba(255, 255, 255, 0.95);
            color: #1e1b4b;
        }
    </style>
</head>

<body
    class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-teal-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900">
    <!-- èƒŒæ™¯è£…é¥° -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute -top-40 -right-40 w-80 h-80 bg-purple-300/30 rounded-full blur-3xl"></div>
        <div class="absolute top-1/2 -left-40 w-80 h-80 bg-blue-300/30 rounded-full blur-3xl"></div>
        <div class="absolute -bottom-40 right-1/3 w-80 h-80 bg-teal-300/30 rounded-full blur-3xl"></div>
    </div>

    <!-- ç™»å½•æ¨¡æ€æ¡† - é»˜è®¤éšè—é˜²æ­¢é—ªçƒ -->
    <div id="loginModal" class="modal-backdrop fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="modal-content bg-white dark:bg-slate-800 rounded-2xl p-6 max-w-sm w-full mx-4">
            <h3 class="text-xl font-semibold mb-4 text-slate-800 dark:text-white text-center">ğŸ” ç®¡ç†å‘˜ç™»å½•</h3>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm text-slate-600 dark:text-slate-300 mb-1">ç®¡ç†å‘˜å¯†ç </label>
                    <input type="password" id="loginPassword" required placeholder="è¯·è¾“å…¥å¯†ç "
                        class="w-full px-4 py-3 rounded-lg bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-800 dark:text-white focus:border-purple-500 focus:outline-none text-center text-lg">
                </div>
                <div>
                    <label class="block text-sm text-slate-600 dark:text-slate-300 mb-1">éªŒè¯ç </label>
                    <div class="flex gap-3 items-center">
                        <div id="captchaQuestion"
                            class="flex-shrink-0 px-4 py-2 bg-gradient-to-r from-purple-100 to-blue-100 dark:from-purple-900/30 dark:to-blue-900/30 rounded-lg text-slate-800 dark:text-white font-mono text-lg font-bold select-none">
                            <!-- éªŒè¯ç å°†ç”±JSç”Ÿæˆ -->
                        </div>
                        <span class="text-slate-500">=</span>
                        <input type="text" id="captchaAnswer" required placeholder="?" autocomplete="off"
                            class="flex-1 px-4 py-2 rounded-lg bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-800 dark:text-white focus:border-purple-500 focus:outline-none text-center text-lg font-mono w-20">
                        <button type="button" onclick="refreshCaptcha()"
                            class="p-2 text-slate-500 hover:text-purple-500 transition-colors" title="åˆ·æ–°éªŒè¯ç ">
                            ğŸ”„
                        </button>
                    </div>
                </div>
                <button type="submit" id="loginBtn"
                    class="w-full px-4 py-3 bg-purple-600 hover:bg-purple-500 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    ç™»å½•ç®¡ç†åå°
                </button>
                <p id="loginError" class="text-red-500 text-center text-sm hidden"></p>
                <p id="loginLockout" class="text-orange-500 text-center text-sm hidden"></p>
            </form>
            <p class="text-center text-slate-500 text-xs mt-4">ä»…é™ç®¡ç†å‘˜è®¿é—®</p>
        </div>
    </div>

    <div class="relative z-10 container mx-auto px-4 py-8" style="max-width: 1152px;">
        <!-- å¤´éƒ¨ -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800 dark:text-white mb-2">ğŸ› ï¸ å¯¼èˆªç«™ç®¡ç†é¢æ¿</h1>
            <p class="text-slate-600 dark:text-slate-400 mb-4">å®æ—¶åŒæ­¥åˆ°çº¿ä¸Šï¼Œæ•°æ®è‡ªåŠ¨ä¿å­˜åˆ°æœåŠ¡å™¨</p>
            <div class="flex items-center justify-center gap-4">
                <a href="index.html" class="text-purple-600 dark:text-purple-400 hover:text-purple-500">â† è¿”å›å¯¼èˆªç«™</a>
                <span id="syncStatus" class="text-sm text-green-600 dark:text-green-400">âœ… å·²è¿æ¥</span>
            </div>
        </header>

        <!-- æ“ä½œå·¥å…·æ  -->
        <section
            class="bg-white/70 dark:bg-slate-800/70 backdrop-blur-sm rounded-2xl p-4 mb-6 border border-slate-200/70 dark:border-slate-700/70">
            <div class="flex flex-wrap gap-3 justify-center action-buttons">
                <button onclick="importFromScript()"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-medium transition-colors flex items-center gap-2">
                    ğŸ“¥ ä» script.js å¯¼å…¥
                </button>
                <button onclick="exportToScript()"
                    class="px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg font-medium transition-colors flex items-center gap-2">
                    ğŸ“¤ å¯¼å‡ºåˆ° script.js
                </button>
                <button onclick="downloadBackup()"
                    class="px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg font-medium transition-colors flex items-center gap-2">
                    ğŸ’¾ ä¸‹è½½å¤‡ä»½
                </button>
                <label
                    class="px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg font-medium transition-colors flex items-center gap-2 cursor-pointer">
                    ğŸ“‚ æ¢å¤å¤‡ä»½
                    <input type="file" accept=".json" onchange="restoreBackup(event)" class="hidden">
                </label>
                <button onclick="openAddModal()"
                    class="px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg font-medium transition-colors flex items-center gap-2">
                    â• æ·»åŠ ç½‘ç«™
                </button>
                <button onclick="checkAllLinks()"
                    class="px-4 py-2 bg-orange-600 hover:bg-orange-500 text-white rounded-lg font-medium transition-colors flex items-center gap-2">
                    ğŸ” æ£€æµ‹é“¾æ¥
                </button>
                <a href="seo-tool.html" target="_blank"
                    class="px-4 py-2 bg-teal-600 hover:bg-teal-500 text-white rounded-lg font-medium transition-colors flex items-center gap-2">
                    ğŸ“Š SEO åˆ†æ
                </a>
            </div>
            <p class="text-center text-slate-500 dark:text-slate-400 text-sm mt-3 drag-hint">
                ğŸ’¡ æ‹–æ‹½å¡ç‰‡å¯è°ƒæ•´æ’åº
            </p>
        </section>

        <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
        <div class="flex gap-2 mb-6 justify-center">
            <button onclick="switchTab('sites')" id="tab-sites"
                class="tab-btn px-6 py-2 rounded-full border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-300 hover:border-purple-500 active">
                ğŸŒ ç½‘ç«™ç®¡ç†
            </button>
            <button onclick="switchTab('links')" id="tab-links"
                class="tab-btn px-6 py-2 rounded-full border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-300 hover:border-purple-500">
                ğŸ”— å‹é“¾ç®¡ç†
            </button>
        </div>

        <!-- ç½‘ç«™ç®¡ç†é¢æ¿ -->
        <div id="panel-sites">
            <!-- ç½‘ç«™å¡ç‰‡åŒºåŸŸ -->
            <main id="siteContainer">
                <!-- å°†ç”± JS åŠ¨æ€ç”Ÿæˆ -->
            </main>
        </div>

        <!-- å‹é“¾ç®¡ç†é¢æ¿ -->
        <div id="panel-links" class="hidden">
            <!-- æ·»åŠ å‹é“¾è¡¨å• -->
            <section
                class="bg-white/70 dark:bg-slate-800/70 backdrop-blur-sm rounded-2xl p-6 mb-6 border border-slate-200/70 dark:border-slate-700/70">
                <h2 class="text-xl font-semibold mb-4 text-slate-800 dark:text-white">â• æ·»åŠ å‹æƒ…é“¾æ¥</h2>
                <form id="addLinkForm" class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <input type="text" id="linkName" required placeholder="ç½‘ç«™åç§°"
                            class="w-full px-4 py-2 rounded-lg bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-800 dark:text-white focus:border-purple-500 focus:outline-none">
                    </div>
                    <div class="flex-1">
                        <input type="url" id="linkUrl" required placeholder="https://example.com"
                            class="w-full px-4 py-2 rounded-lg bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-800 dark:text-white focus:border-purple-500 focus:outline-none">
                    </div>
                    <button type="submit"
                        class="px-6 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg font-medium transition-colors whitespace-nowrap">
                        æ·»åŠ å‹é“¾
                    </button>
                </form>
            </section>

            <!-- å‹é“¾åˆ—è¡¨ -->
            <section
                class="bg-white/70 dark:bg-slate-800/70 backdrop-blur-sm rounded-2xl p-6 border border-slate-200/70 dark:border-slate-700/70">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-slate-800 dark:text-white">ğŸ”— å‹é“¾åˆ—è¡¨</h2>
                    <span id="linkCount" class="text-slate-500 dark:text-slate-400 text-sm">0 ä¸ªå‹é“¾</span>
                </div>
                <div id="linkList" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                    <p class="text-slate-500 text-center py-4 col-span-full">æš‚æ— å‹é“¾æ•°æ®</p>
                </div>
            </section>
        </div>

        <!-- åº•éƒ¨ç»Ÿè®¡ -->
        <footer class="text-center text-slate-500 dark:text-slate-400 text-sm py-6 mt-8">
            <p id="statsInfo">å…± 0 ä¸ªç½‘ç«™ Â· 0 ä¸ªå‹é“¾</p>
            <p class="mt-1">æ•°æ®è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°æµè§ˆå™¨</p>
        </footer>
    </div>

    <!-- Toast é€šçŸ¥ -->
    <div id="toast"
        class="fixed top-4 right-4 px-6 py-3 bg-green-600 text-white rounded-lg shadow-lg hidden toast z-50"></div>

    <!-- æ·»åŠ /ç¼–è¾‘ç½‘ç«™æ¨¡æ€æ¡† -->
    <div id="editModal" class="modal-backdrop fixed inset-0 bg-black/50 flex items-center justify-center z-40 hidden">
        <div
            class="modal-content bg-white dark:bg-slate-800 rounded-2xl p-6 max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 id="modalTitle" class="text-xl font-semibold mb-4 text-slate-800 dark:text-white">â• æ·»åŠ ç½‘ç«™</h3>
            <form id="editSiteForm" class="space-y-4">
                <input type="hidden" id="editSiteId">
                <input type="hidden" id="editSiteCategory">
                <input type="hidden" id="editSiteIndex">
                <div>
                    <label class="block text-sm text-slate-600 dark:text-slate-300 mb-1">åˆ†ç±» *</label>
                    <select id="editSiteCategorySelect" required
                        class="w-full px-4 py-2 rounded-lg bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-800 dark:text-white focus:border-purple-500 focus:outline-none">
                        <option value="common">å¸¸ç”¨å·¥å…·</option>
                        <option value="tier1">ä¸€çº¿æœºåœº</option>
                        <option value="tier2">äºŒçº¿æœºåœº</option>
                        <option value="stable">ç¨³å®šæœºåœº</option>
                        <option value="budget">ä½ä»·ä¸“åŒº</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm text-slate-600 dark:text-slate-300 mb-1">ç½‘ç«™åç§° *</label>
                    <input type="text" id="editSiteName" required placeholder="å¦‚ï¼šTAG VPN"
                        class="w-full px-4 py-2 rounded-lg bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-800 dark:text-white focus:border-purple-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm text-slate-600 dark:text-slate-300 mb-1">ç½‘ç«™é“¾æ¥ *</label>
                    <input type="url" id="editSiteUrl" required placeholder="https://example.com"
                        class="w-full px-4 py-2 rounded-lg bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-800 dark:text-white focus:border-purple-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm text-slate-600 dark:text-slate-300 mb-1">ç½‘ç«™æè¿° *</label>
                    <input type="text" id="editSiteDesc" required placeholder="ç®€çŸ­æè¿°è¿™ä¸ªç½‘ç«™"
                        class="w-full px-4 py-2 rounded-lg bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-800 dark:text-white focus:border-purple-500 focus:outline-none">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-slate-600 dark:text-slate-300 mb-1">å›¾æ ‡ (Emoji)</label>
                        <input type="text" id="editSiteIcon" maxlength="2" placeholder="ğŸš€"
                            class="w-full px-4 py-2 rounded-lg bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-800 dark:text-white focus:border-purple-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm text-slate-600 dark:text-slate-300 mb-1">èƒŒæ™¯é¢œè‰²</label>
                        <select id="editSiteColor"
                            class="w-full px-4 py-2 rounded-lg bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-800 dark:text-white focus:border-purple-500 focus:outline-none">
                            <option value="bg-blue-100 dark:bg-blue-900/30">è“è‰²</option>
                            <option value="bg-purple-100 dark:bg-purple-900/30">ç´«è‰²</option>
                            <option value="bg-green-100 dark:bg-green-900/30">ç»¿è‰²</option>
                            <option value="bg-orange-100 dark:bg-orange-900/30">æ©™è‰²</option>
                            <option value="bg-pink-100 dark:bg-pink-900/30">ç²‰è‰²</option>
                            <option value="bg-teal-100 dark:bg-teal-900/30">é’è‰²</option>
                            <option value="bg-yellow-100 dark:bg-yellow-900/30">é»„è‰²</option>
                            <option value="bg-indigo-100 dark:bg-indigo-900/30">é›è“</option>
                            <option value="bg-sky-100 dark:bg-sky-900/30">å¤©è“</option>
                            <option value="bg-rose-100 dark:bg-rose-900/30">ç«çº¢</option>
                            <option value="bg-slate-100 dark:bg-slate-700/30">ç°è‰²</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-slate-600 dark:text-slate-300 mb-1">è‡ªå®šä¹‰å›¾æ ‡URL (å¯é€‰)</label>
                    <input type="url" id="editSiteIconUrl" placeholder="https://example.com/icon.png"
                        class="w-full px-4 py-2 rounded-lg bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-800 dark:text-white focus:border-purple-500 focus:outline-none">
                    <p class="text-xs text-slate-500 mt-1">ä¼˜å…ˆçº§ï¼šè‡ªå®šä¹‰å›¾æ ‡ â†’ Google Favicon â†’ Emoji</p>
                </div>
                <div class="flex gap-3 pt-2">
                    <button type="submit"
                        class="flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg font-medium transition-colors">
                        ä¿å­˜
                    </button>
                    <button type="button" onclick="closeEditModal()"
                        class="flex-1 px-4 py-2 bg-slate-200 dark:bg-slate-600 hover:bg-slate-300 dark:hover:bg-slate-500 text-slate-800 dark:text-white rounded-lg font-medium transition-colors">
                        å–æ¶ˆ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- å‹é“¾ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div id="editLinkModal"
        class="modal-backdrop fixed inset-0 bg-black/50 flex items-center justify-center z-40 hidden">
        <div class="modal-content bg-white dark:bg-slate-800 rounded-2xl p-6 max-w-lg w-full mx-4">
            <h3 class="text-xl font-semibold mb-4 text-slate-800 dark:text-white">âœï¸ ç¼–è¾‘å‹é“¾</h3>
            <form id="editLinkForm" class="space-y-4">
                <input type="hidden" id="editLinkId">
                <div>
                    <label class="block text-sm text-slate-600 dark:text-slate-300 mb-1">ç½‘ç«™åç§° *</label>
                    <input type="text" id="editLinkName" required
                        class="w-full px-4 py-2 rounded-lg bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-800 dark:text-white focus:border-purple-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm text-slate-600 dark:text-slate-300 mb-1">ç½‘ç«™é“¾æ¥ *</label>
                    <input type="url" id="editLinkUrl" required
                        class="w-full px-4 py-2 rounded-lg bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-800 dark:text-white focus:border-purple-500 focus:outline-none">
                </div>
                <div class="flex gap-3 pt-2">
                    <button type="submit"
                        class="flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg font-medium transition-colors">
                        ä¿å­˜ä¿®æ”¹
                    </button>
                    <button type="button" onclick="closeEditLinkModal()"
                        class="flex-1 px-4 py-2 bg-slate-200 dark:bg-slate-600 hover:bg-slate-300 dark:hover:bg-slate-500 text-slate-800 dark:text-white rounded-lg font-medium transition-colors">
                        å–æ¶ˆ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- é“¾æ¥æ£€æµ‹æ¨¡æ€æ¡† -->
    <div id="linkCheckModal"
        class="modal-backdrop fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div
            class="modal-content bg-white dark:bg-slate-800 rounded-2xl p-6 max-w-3xl w-full mx-4 max-h-[85vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-slate-800 dark:text-white">ğŸ” é“¾æ¥æ‰¹é‡æ£€æµ‹</h3>
                <button onclick="closeLinkCheckModal()"
                    class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 text-2xl">&times;</button>
            </div>

            <!-- æç¤ºä¿¡æ¯ -->
            <div id="checkTips"
                class="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-700 rounded-lg p-3 mb-4 text-sm text-amber-800 dark:text-amber-200">
                <p class="font-medium mb-1">âš ï¸ æ£€æµ‹é¡»çŸ¥ï¼š</p>
                <ul class="list-disc list-inside space-y-0.5 text-xs">
                    <li>æ£€æµ‹è¾ƒä¸ºè€—æ—¶ï¼Œæ£€æµ‹æœŸé—´è¯·å‹¿å…³é—­æ­¤é¡µé¢</li>
                    <li>éƒ¨åˆ†ç½‘ç«™å¯ç”¨äº† CDN æˆ–é˜²ç«å¢™ï¼Œå¯èƒ½æ˜¾ç¤ºä¸º"æœªçŸ¥"çŠ¶æ€</li>
                    <li>æ£€æµ‹ç»“æœä»…ä¾›å‚è€ƒï¼Œå…·ä½“ä»¥å®é™…è®¿é—®ä¸ºå‡†</li>
                </ul>
            </div>

            <!-- è¿›åº¦æ¡ -->
            <div id="checkProgress" class="mb-4">
                <div class="flex justify-between text-sm text-slate-600 dark:text-slate-400 mb-1">
                    <span id="checkProgressText">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹æ£€æµ‹</span>
                    <span id="checkProgressPercent">0%</span>
                </div>
                <div class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-3">
                    <div id="checkProgressBar"
                        class="bg-gradient-to-r from-purple-500 to-indigo-500 h-3 rounded-full transition-all duration-300 relative"
                        style="width: 0%">
                        <span class="absolute right-2 top-0 text-[10px] text-white font-medium leading-3"
                            id="checkProgressInner"></span>
                    </div>
                </div>
            </div>

            <!-- ç»Ÿè®¡æ‘˜è¦ -->
            <div id="checkSummary" class="grid grid-cols-5 gap-2 mb-4 hidden">
                <div class="bg-green-100 dark:bg-green-900/30 rounded-lg p-2 text-center cursor-pointer hover:ring-2 ring-green-500"
                    onclick="filterResults('ok')">
                    <div class="text-xl font-bold text-green-600 dark:text-green-400" id="countOk">0</div>
                    <div class="text-xs text-green-700 dark:text-green-300">âœ… æ­£å¸¸</div>
                </div>
                <div class="bg-red-100 dark:bg-red-900/30 rounded-lg p-2 text-center cursor-pointer hover:ring-2 ring-red-500"
                    onclick="filterResults('error')">
                    <div class="text-xl font-bold text-red-600 dark:text-red-400" id="countError">0</div>
                    <div class="text-xs text-red-700 dark:text-red-300">âŒ å¼‚å¸¸</div>
                </div>
                <div class="bg-yellow-100 dark:bg-yellow-900/30 rounded-lg p-2 text-center cursor-pointer hover:ring-2 ring-yellow-500"
                    onclick="filterResults('timeout')">
                    <div class="text-xl font-bold text-yellow-600 dark:text-yellow-400" id="countTimeout">0</div>
                    <div class="text-xs text-yellow-700 dark:text-yellow-300">â±ï¸ è¶…æ—¶</div>
                </div>
                <div class="bg-cyan-100 dark:bg-cyan-900/30 rounded-lg p-2 text-center cursor-pointer hover:ring-2 ring-cyan-500"
                    onclick="filterResults('unknown')">
                    <div class="text-xl font-bold text-cyan-600 dark:text-cyan-400" id="countUnknown">0</div>
                    <div class="text-xs text-cyan-700 dark:text-cyan-300">â“ æœªçŸ¥</div>
                </div>
                <div class="bg-slate-100 dark:bg-slate-700/50 rounded-lg p-2 text-center cursor-pointer hover:ring-2 ring-slate-500"
                    onclick="filterResults('all')">
                    <div class="text-xl font-bold text-slate-600 dark:text-slate-400" id="countTotal">0</div>
                    <div class="text-xs text-slate-700 dark:text-slate-300">ğŸ“Š å…¨éƒ¨</div>
                </div>
            </div>

            <!-- ç»“æœåˆ—è¡¨ -->
            <div id="checkResults" class="flex-1 overflow-y-auto space-y-2 min-h-[200px] max-h-[350px]">
                <div class="text-center py-8">
                    <p class="text-slate-500 mb-4">å‡†å¤‡æ£€æµ‹æ‰€æœ‰ç½‘ç«™å’Œå‹é“¾çš„å¯è®¿é—®æ€§</p>
                    <button onclick="startLinkCheck()" id="btnStartCheck"
                        class="px-6 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg font-medium transition-colors">
                        ğŸš€ å¼€å§‹æ£€æµ‹
                    </button>
                </div>
            </div>

            <!-- åº•éƒ¨æŒ‰é’® -->
            <div class="flex gap-3 pt-4 mt-4 border-t border-slate-200 dark:border-slate-700">
                <button onclick="filterResults('problems')" id="btnShowProblems"
                    class="px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg font-medium transition-colors hidden">
                    âš ï¸ ä»…æ˜¾ç¤ºé—®é¢˜
                </button>
                <button onclick="exportCheckResults()" id="btnExportResults"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-medium transition-colors hidden">
                    ğŸ“‹ å¯¼å‡ºæŠ¥å‘Š
                </button>
                <button onclick="closeLinkCheckModal()"
                    class="flex-1 px-4 py-2 bg-slate-200 dark:bg-slate-600 hover:bg-slate-300 dark:hover:bg-slate-500 text-slate-800 dark:text-white rounded-lg font-medium transition-colors">
                    å…³é—­
                </button>
            </div>
        </div>
    </div>

    <script>
        // ==================== é…ç½®å’ŒçŠ¶æ€ ====================
        const STORAGE_KEY = 'navsite_data';
        const API_BASE = '/api';
        const MAX_LOGIN_ATTEMPTS = 5;  // æœ€å¤§ç™»å½•å°è¯•æ¬¡æ•°
        const LOCKOUT_DURATION = 5 * 60 * 1000;  // é”å®šæ—¶é•¿ 5 åˆ†é’Ÿ

        // è®¤è¯çŠ¶æ€
        let authToken = localStorage.getItem('admin_token') || null;
        let isLoggedIn = false;

        // éªŒè¯ç çŠ¶æ€
        let captchaNum1 = 0;
        let captchaNum2 = 0;
        let captchaOperator = '+';
        let captchaResult = 0;

        // ç™»å½•å°è¯•é™åˆ¶
        let loginAttempts = parseInt(localStorage.getItem('login_attempts') || '0');
        let lockoutUntil = parseInt(localStorage.getItem('lockout_until') || '0');

        const categoryNames = {
            common: 'å¸¸ç”¨å·¥å…·',
            tier1: 'ä¸€çº¿æœºåœº',
            tier2: 'äºŒçº¿æœºåœº',
            stable: 'ç¨³å®šæœºåœº',
            budget: 'ä½ä»·ä¸“åŒº'
        };

        const categoryDots = {
            common: 'category-dot-common',
            tier1: 'category-dot-tier1',
            tier2: 'category-dot-tier2',
            stable: 'category-dot-stable',
            budget: 'category-dot-budget'
        };

        // åˆå§‹åŒ–æ•°æ®
        let siteData = {
            common: [],
            tier1: [],
            tier2: [],
            stable: [],
            budget: [],
            friendLinks: []
        };

        // æ‹–æ‹½çŠ¶æ€
        let draggedElement = null;
        let draggedCategory = null;
        let draggedIndex = null;

        // ==================== è®¤è¯åŠŸèƒ½ ====================

        async function login(password) {
            try {
                const response = await fetch(`${API_BASE}/auth`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    authToken = data.token;
                    localStorage.setItem('admin_token', authToken);
                    isLoggedIn = true;
                    return true;
                } else {
                    return false;
                }
            } catch (error) {
                console.error('ç™»å½•å¤±è´¥:', error);
                return false;
            }
        }

        function showLoginModal() {
            generateCaptcha();  // æ˜¾ç¤ºç™»å½•æ¡†æ—¶ç”ŸæˆéªŒè¯ç 
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('loginPassword').focus();
        }

        function hideLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
        }

        // ==================== éªŒè¯ç åŠŸèƒ½ ====================

        function generateCaptcha() {
            const operators = ['+', '-', 'Ã—'];
            captchaOperator = operators[Math.floor(Math.random() * operators.length)];

            if (captchaOperator === '+') {
                captchaNum1 = Math.floor(Math.random() * 20) + 1;
                captchaNum2 = Math.floor(Math.random() * 20) + 1;
                captchaResult = captchaNum1 + captchaNum2;
            } else if (captchaOperator === '-') {
                captchaNum1 = Math.floor(Math.random() * 20) + 10;
                captchaNum2 = Math.floor(Math.random() * captchaNum1);
                captchaResult = captchaNum1 - captchaNum2;
            } else {
                captchaNum1 = Math.floor(Math.random() * 9) + 1;
                captchaNum2 = Math.floor(Math.random() * 9) + 1;
                captchaResult = captchaNum1 * captchaNum2;
            }

            const captchaEl = document.getElementById('captchaQuestion');
            if (captchaEl) {
                captchaEl.textContent = `${captchaNum1} ${captchaOperator} ${captchaNum2}`;
            }
        }

        function refreshCaptcha() {
            generateCaptcha();
            document.getElementById('captchaAnswer').value = '';
            document.getElementById('captchaAnswer').focus();
        }

        function verifyCaptcha() {
            const answer = parseInt(document.getElementById('captchaAnswer').value, 10);
            return answer === captchaResult;
        }

        function checkLockout() {
            if (Date.now() < lockoutUntil) {
                const remainingSeconds = Math.ceil((lockoutUntil - Date.now()) / 1000);
                const minutes = Math.floor(remainingSeconds / 60);
                const seconds = remainingSeconds % 60;
                return `è´¦æˆ·å·²é”å®šï¼Œè¯· ${minutes}:${seconds.toString().padStart(2, '0')} åé‡è¯•`;
            }
            // é”å®šæ—¶é—´å·²è¿‡ï¼Œé‡ç½®å°è¯•æ¬¡æ•°
            if (lockoutUntil > 0 && Date.now() >= lockoutUntil) {
                loginAttempts = 0;
                lockoutUntil = 0;
                localStorage.setItem('login_attempts', '0');
                localStorage.setItem('lockout_until', '0');
            }
            return null;
        }

        function recordFailedAttempt() {
            loginAttempts++;
            localStorage.setItem('login_attempts', loginAttempts.toString());

            if (loginAttempts >= MAX_LOGIN_ATTEMPTS) {
                lockoutUntil = Date.now() + LOCKOUT_DURATION;
                localStorage.setItem('lockout_until', lockoutUntil.toString());
                return `å°è¯•æ¬¡æ•°è¿‡å¤šï¼Œè´¦æˆ·å·²é”å®š 5 åˆ†é’Ÿ`;
            }

            return `å¯†ç æˆ–éªŒè¯ç é”™è¯¯ï¼Œè¿˜å‰© ${MAX_LOGIN_ATTEMPTS - loginAttempts} æ¬¡å°è¯•æœºä¼š`;
        }

        function resetLoginAttempts() {
            loginAttempts = 0;
            lockoutUntil = 0;
            localStorage.setItem('login_attempts', '0');
            localStorage.setItem('lockout_until', '0');
        }

        // ç™»å½•è¡¨å•å¤„ç†
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();

                const errorEl = document.getElementById('loginError');
                const lockoutEl = document.getElementById('loginLockout');

                // æ£€æŸ¥æ˜¯å¦è¢«é”å®š
                const lockoutMsg = checkLockout();
                if (lockoutMsg) {
                    lockoutEl.textContent = lockoutMsg;
                    lockoutEl.classList.remove('hidden');
                    errorEl.classList.add('hidden');
                    return;
                }

                // éªŒè¯éªŒè¯ç 
                if (!verifyCaptcha()) {
                    const errMsg = recordFailedAttempt();
                    errorEl.textContent = errMsg;
                    errorEl.classList.remove('hidden');
                    lockoutEl.classList.add('hidden');
                    refreshCaptcha();
                    return;
                }

                const password = document.getElementById('loginPassword').value;
                const success = await login(password);

                if (success) {
                    resetLoginAttempts();
                    hideLoginModal();
                    errorEl.classList.add('hidden');
                    lockoutEl.classList.add('hidden');
                    await loadFromAPI();
                    renderAll();
                    updateSyncStatus('connected');
                } else {
                    const errMsg = recordFailedAttempt();
                    errorEl.textContent = errMsg;
                    errorEl.classList.remove('hidden');
                    refreshCaptcha();
                }
            });
        });

        // ==================== API æ•°æ®æ“ä½œ ====================

        async function loadFromAPI() {
            try {
                const response = await fetch(`${API_BASE}/sites`);
                if (response.ok) {
                    const data = await response.json();
                    siteData = {
                        common: data.common || [],
                        tier1: data.tier1 || [],
                        tier2: data.tier2 || [],
                        stable: data.stable || [],
                        budget: data.budget || [],
                        friendLinks: data.friendLinks || []
                    };
                    // åŒæ—¶ä¿å­˜åˆ°æœ¬åœ°ä½œä¸ºå¤‡ä»½
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(siteData));
                    console.log('âœ… æ•°æ®å·²ä» API åŠ è½½');
                    return true;
                }
            } catch (error) {
                console.warn('âš ï¸ API åŠ è½½å¤±è´¥ï¼Œå°è¯•ä»æœ¬åœ°æ¢å¤:', error);
            }
            // é™çº§åˆ°æœ¬åœ°å­˜å‚¨
            loadFromStorage();
            return false;
        }

        async function saveToAPI() {
            if (!authToken) {
                showToast('è¯·å…ˆç™»å½•', 'error');
                showLoginModal();
                return false;
            }

            try {
                updateSyncStatus('syncing');

                const response = await fetch(`${API_BASE}/sites`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(siteData)
                });

                if (response.ok) {
                    updateSyncStatus('connected');
                    console.log('âœ… æ•°æ®å·²åŒæ­¥åˆ°æœåŠ¡å™¨');
                    return true;
                } else if (response.status === 401) {
                    // Token è¿‡æœŸï¼Œéœ€è¦é‡æ–°ç™»å½•
                    authToken = null;
                    localStorage.removeItem('admin_token');
                    showToast('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•', 'error');
                    showLoginModal();
                    updateSyncStatus('disconnected');
                    return false;
                } else {
                    throw new Error('ä¿å­˜å¤±è´¥');
                }
            } catch (error) {
                console.error('ä¿å­˜åˆ° API å¤±è´¥:', error);
                updateSyncStatus('error');
                showToast('åŒæ­¥å¤±è´¥ï¼Œæ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°', 'error');
                return false;
            }
        }

        function updateSyncStatus(status) {
            const el = document.getElementById('syncStatus');
            switch (status) {
                case 'connected':
                    el.textContent = 'âœ… å·²è¿æ¥';
                    el.className = 'text-sm text-green-600 dark:text-green-400';
                    break;
                case 'syncing':
                    el.textContent = 'ğŸ”„ åŒæ­¥ä¸­...';
                    el.className = 'text-sm text-yellow-600 dark:text-yellow-400';
                    break;
                case 'disconnected':
                    el.textContent = 'âš ï¸ æœªè¿æ¥';
                    el.className = 'text-sm text-red-600 dark:text-red-400';
                    break;
                case 'error':
                    el.textContent = 'âŒ åŒæ­¥å¤±è´¥';
                    el.className = 'text-sm text-red-600 dark:text-red-400';
                    break;
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
        document.addEventListener('DOMContentLoaded', async () => {
            initDarkMode();

            // å¦‚æœæœ‰ tokenï¼Œå°è¯•åŠ è½½æ•°æ®éªŒè¯ token æ˜¯å¦æœ‰æ•ˆ
            if (authToken) {
                const apiLoaded = await loadFromAPI();
                if (apiLoaded) {
                    isLoggedIn = true;
                    hideLoginModal();
                    renderAll();
                    updateSyncStatus('connected');
                } else {
                    // API ä¸å¯ç”¨æˆ– token æ— æ•ˆï¼Œæ˜¾ç¤ºç™»å½•æ¡†
                    loadFromStorage();
                    renderAll();
                    showLoginModal();
                    updateSyncStatus('disconnected');
                }
            } else {
                // æ²¡æœ‰ tokenï¼Œæ˜¾ç¤ºç™»å½•æ¡†
                loadFromStorage();
                renderAll();
                showLoginModal();
                updateSyncStatus('disconnected');
            }
        });

        // ==================== æš—è‰²æ¨¡å¼ ====================

        function initDarkMode() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.documentElement.classList.add('dark');
            }
        }

        // ==================== æ•°æ®æŒä¹…åŒ– ====================

        function saveToStorage() {
            // ä¿å­˜åˆ°æœ¬åœ°ä½œä¸ºå¤‡ä»½
            localStorage.setItem(STORAGE_KEY, JSON.stringify(siteData));
            // åŒæ—¶å°è¯•ä¿å­˜åˆ° API
            saveToAPI();
        }

        function loadFromStorage() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    siteData = JSON.parse(saved);
                    if (!siteData.common) siteData.common = [];
                    if (!siteData.tier1) siteData.tier1 = [];
                    if (!siteData.tier2) siteData.tier2 = [];
                    if (!siteData.stable) siteData.stable = [];
                    if (!siteData.budget) siteData.budget = [];
                    if (!siteData.friendLinks) siteData.friendLinks = [];
                } catch (e) {
                    console.error('åŠ è½½æ•°æ®å¤±è´¥:', e);
                }
            }
        }

        // ==================== é€šçŸ¥ ====================

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg toast z-50 text-white ${type === 'success' ? 'bg-green-600' : 'bg-red-600'}`;
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }

        // ==================== æ¸²æŸ“ ====================

        function renderAll() {
            renderSiteContainer();
            renderLinkList();
            updateStats();
        }

        function renderSiteContainer() {
            const container = document.getElementById('siteContainer');
            const categories = ['common', 'tier1', 'tier2', 'stable', 'budget'];

            let html = '';
            categories.forEach(cat => {
                const sites = siteData[cat] || [];
                html += `
                    <section id="${cat}" class="mb-10">
                        <div class="flex items-center gap-2 mb-4">
                            <span class="w-2 h-2 rounded-full ${categoryDots[cat]}"></span>
                            <h2 class="text-xl font-bold text-slate-800 dark:text-white">${categoryNames[cat]}</h2>
                            <span class="text-slate-500 text-sm">(${sites.length})</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" 
                             id="${cat}-cards"
                             data-category="${cat}"
                             ondragover="handleDragOver(event)"
                             ondrop="handleDrop(event)">
                            ${sites.length > 0 ? sites.map((site, index) => createSiteCard(site, cat, index)).join('') :
                        `<div class="col-span-full text-center py-8 text-slate-400 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-2xl">
                                  æš‚æ— ç½‘ç«™ï¼Œç‚¹å‡»ä¸Šæ–¹"æ·»åŠ ç½‘ç«™"æˆ–æ‹–æ‹½å…¶ä»–åˆ†ç±»çš„å¡ç‰‡åˆ°è¿™é‡Œ
                              </div>`}
                        </div>
                    </section>
                `;
            });

            container.innerHTML = html;
        }

        // è·å– favicon URL
        function getFaviconUrl(url, size = 32) {
            try {
                const domain = new URL(url).hostname;
                return `https://www.google.com/s2/favicons?domain=${domain}&sz=${size}`;
            } catch {
                return null;
            }
        }

        // åˆ›å»ºç½‘ç«™å¡ç‰‡ - ä¸å‰å°ä¸€è‡´çš„æ ·å¼
        function createSiteCard(site, category, index) {
            const faviconUrl = getFaviconUrl(site.url);
            const customIconUrl = site.iconUrl || '';
            const emojiIcon = site.icon || 'ğŸ”—';

            // ä¼˜å…ˆçº§ï¼šè‡ªå®šä¹‰å›¾æ ‡URLï¼ˆå¦‚æœ‰ï¼‰â†’ Google Favicon â†’ Emoji
            let iconHtml;
            if (customIconUrl) {
                // æœ‰è‡ªå®šä¹‰å›¾æ ‡URLæ—¶ï¼Œä¼˜å…ˆä½¿ç”¨è‡ªå®šä¹‰å›¾æ ‡ï¼Œå¤±è´¥æ—¶æ˜¾ç¤ºEmoji
                iconHtml = `<img src="${customIconUrl}" alt="${site.name}" class="w-6 h-6 rounded" loading="lazy" onerror="this.style.display='none';this.nextElementSibling.style.display='block';">
                   <span style="display:none">${emojiIcon}</span>`;
            } else if (faviconUrl) {
                // æ²¡æœ‰è‡ªå®šä¹‰å›¾æ ‡æ—¶ï¼Œä½¿ç”¨ Google Faviconï¼Œå¤±è´¥æ—¶æ˜¾ç¤ºEmoji
                iconHtml = `<img src="${faviconUrl}" alt="${site.name}" class="w-6 h-6 rounded" loading="lazy" onerror="this.style.display='none';this.nextElementSibling.style.display='block';">
                   <span style="display:none">${emojiIcon}</span>`;
            } else {
                // éƒ½æ²¡æœ‰ï¼Œç›´æ¥æ˜¾ç¤º Emoji
                iconHtml = emojiIcon;
            }

            return `
                <div class="site-card desc-tooltip relative block p-4 rounded-2xl bg-white/70 dark:bg-slate-800/70 backdrop-blur-sm border border-slate-200/70 dark:border-slate-700/70 hover:bg-white dark:hover:bg-slate-700/90"
                     data-tooltip="${site.desc}"
                     draggable="true"
                     data-category="${category}"
                     data-index="${index}"
                     ondragstart="handleDragStart(event)"
                     ondragend="handleDragEnd(event)"
                     ondragover="handleCardDragOver(event)"
                     ondragleave="handleCardDragLeave(event)">
                    
                    <!-- æ“ä½œæŒ‰é’® -->
                    <div class="card-actions">
                        <button onclick="event.stopPropagation(); editSite('${category}', ${index})" 
                            class="card-action-btn bg-blue-500 hover:bg-blue-400 text-white" title="ç¼–è¾‘">
                            âœï¸
                        </button>
                        <button onclick="event.stopPropagation(); deleteSite('${category}', ${index})" 
                            class="card-action-btn bg-red-500 hover:bg-red-400 text-white" title="åˆ é™¤">
                            ğŸ—‘ï¸
                        </button>
                    </div>

                    <div class="flex items-start gap-3">
                        <div class="icon-container ${site.color}">
                            ${iconHtml}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2">
                                <h3 class="font-semibold text-slate-800 dark:text-white truncate">${site.name}</h3>
                                <svg class="external-icon w-4 h-4 text-slate-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                </svg>
                            </div>
                            <p class="text-sm text-slate-600 dark:text-slate-400 mt-1 line-clamp-2">${site.desc}</p>
                            <p class="text-xs text-slate-400 dark:text-slate-500 mt-2">${site.domain}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // ==================== æ‹–æ‹½åŠŸèƒ½ ====================

        function handleDragStart(event) {
            draggedElement = event.target;
            draggedCategory = event.target.dataset.category;
            draggedIndex = parseInt(event.target.dataset.index);

            event.target.classList.add('dragging');
            event.dataTransfer.effectAllowed = 'move';
            event.dataTransfer.setData('text/plain', `${draggedCategory}:${draggedIndex}`);
        }

        function handleDragEnd(event) {
            event.target.classList.remove('dragging');
            document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
            draggedElement = null;
            draggedCategory = null;
            draggedIndex = null;
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.dataTransfer.dropEffect = 'move';
        }

        function handleCardDragOver(event) {
            event.preventDefault();
            if (event.target.closest('.site-card') && event.target.closest('.site-card') !== draggedElement) {
                event.target.closest('.site-card').classList.add('drag-over');
            }
        }

        function handleCardDragLeave(event) {
            event.target.closest('.site-card')?.classList.remove('drag-over');
        }

        function handleDrop(event) {
            event.preventDefault();

            const targetContainer = event.target.closest('[data-category]');
            if (!targetContainer) return;

            const targetCategory = targetContainer.dataset.category;
            const targetCard = event.target.closest('.site-card');

            // è·å–è¢«æ‹–æ‹½çš„ç½‘ç«™æ•°æ®
            const site = siteData[draggedCategory][draggedIndex];

            // ä»åŸä½ç½®åˆ é™¤
            siteData[draggedCategory].splice(draggedIndex, 1);

            // ç¡®å®šæ’å…¥ä½ç½®
            if (targetCard && targetCard !== draggedElement) {
                const targetIndex = parseInt(targetCard.dataset.index);
                // æ’å…¥åˆ°ç›®æ ‡å¡ç‰‡çš„ä½ç½®
                if (draggedCategory === targetCategory && draggedIndex < targetIndex) {
                    siteData[targetCategory].splice(targetIndex, 0, site);
                } else {
                    siteData[targetCategory].splice(targetIndex, 0, site);
                }
            } else {
                // æ’å…¥åˆ°åˆ†ç±»æœ«å°¾
                siteData[targetCategory].push(site);
            }

            saveToStorage();
            renderSiteContainer();
            updateStats();
            showToast('æ’åºå·²æ›´æ–°');
        }

        // ==================== æ ‡ç­¾é¡µåˆ‡æ¢ ====================

        function switchTab(tab) {
            document.getElementById('panel-sites').classList.toggle('hidden', tab !== 'sites');
            document.getElementById('panel-links').classList.toggle('hidden', tab !== 'links');
            document.getElementById('tab-sites').classList.toggle('active', tab === 'sites');
            document.getElementById('tab-links').classList.toggle('active', tab === 'links');
        }

        // ==================== ç½‘ç«™ç®¡ç† ====================

        function openAddModal() {
            document.getElementById('modalTitle').textContent = 'â• æ·»åŠ ç½‘ç«™';
            document.getElementById('editSiteForm').reset();
            document.getElementById('editSiteId').value = '';
            document.getElementById('editSiteCategory').value = '';
            document.getElementById('editSiteIndex').value = '';
            document.getElementById('editSiteCategorySelect').disabled = false;
            document.getElementById('editModal').classList.remove('hidden');
        }

        function editSite(category, index) {
            const site = siteData[category][index];
            document.getElementById('modalTitle').textContent = 'âœï¸ ç¼–è¾‘ç½‘ç«™';
            document.getElementById('editSiteId').value = site.id || '';
            document.getElementById('editSiteCategory').value = category;
            document.getElementById('editSiteIndex').value = index;
            document.getElementById('editSiteCategorySelect').value = category;
            document.getElementById('editSiteCategorySelect').disabled = false;
            document.getElementById('editSiteName').value = site.name;
            document.getElementById('editSiteUrl').value = site.url;
            document.getElementById('editSiteDesc').value = site.desc;
            document.getElementById('editSiteIcon').value = site.icon;
            document.getElementById('editSiteIconUrl').value = site.iconUrl || '';
            document.getElementById('editSiteColor').value = site.color;
            document.getElementById('editModal').classList.remove('hidden');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
        }

        document.getElementById('editSiteForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const url = document.getElementById('editSiteUrl').value;
            let domain;
            try {
                domain = new URL(url).hostname.replace('www.', '');
            } catch {
                domain = url;
            }

            const site = {
                id: document.getElementById('editSiteId').value || Date.now(),
                name: document.getElementById('editSiteName').value,
                desc: document.getElementById('editSiteDesc').value,
                url: url,
                domain: domain,
                icon: document.getElementById('editSiteIcon').value || 'ğŸ”—',
                iconUrl: document.getElementById('editSiteIconUrl').value || '',
                color: document.getElementById('editSiteColor').value
            };

            const oldCategory = document.getElementById('editSiteCategory').value;
            const newCategory = document.getElementById('editSiteCategorySelect').value;
            const index = document.getElementById('editSiteIndex').value;

            if (index !== '' && oldCategory) {
                // ç¼–è¾‘æ¨¡å¼
                if (oldCategory === newCategory) {
                    siteData[oldCategory][parseInt(index)] = site;
                } else {
                    // åˆ†ç±»æ”¹å˜äº†
                    siteData[oldCategory].splice(parseInt(index), 1);
                    siteData[newCategory].push(site);
                }
                showToast('ç½‘ç«™å·²æ›´æ–°');
            } else {
                // æ·»åŠ æ¨¡å¼
                siteData[newCategory].push(site);
                showToast('ç½‘ç«™å·²æ·»åŠ ');
            }

            saveToStorage();
            renderSiteContainer();
            updateStats();
            closeEditModal();
        });

        function deleteSite(category, index) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç½‘ç«™å—ï¼Ÿ')) return;
            siteData[category].splice(index, 1);
            saveToStorage();
            renderSiteContainer();
            updateStats();
            showToast('ç½‘ç«™å·²åˆ é™¤');
        }

        // ==================== å‹é“¾ç®¡ç† ====================

        document.getElementById('addLinkForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const link = {
                id: Date.now(),
                name: document.getElementById('linkName').value,
                url: document.getElementById('linkUrl').value
            };
            siteData.friendLinks.push(link);
            saveToStorage();
            renderLinkList();
            updateStats();
            e.target.reset();
            showToast('å‹é“¾å·²æ·»åŠ ');
        });

        function renderLinkList() {
            const container = document.getElementById('linkList');
            const links = siteData.friendLinks || [];

            if (links.length === 0) {
                container.innerHTML = '<p class="text-slate-500 text-center py-4 col-span-full">æš‚æ— å‹é“¾æ•°æ®</p>';
            } else {
                container.innerHTML = links.map((link, index) => `
                    <div class="relative group p-3 rounded-xl bg-white/50 dark:bg-slate-700/50 border border-slate-200/50 dark:border-slate-600/50">
                        <div class="font-medium text-slate-700 dark:text-slate-300 truncate">${link.name}</div>
                        <div class="text-xs text-slate-500 truncate">${link.url}</div>
                        <div class="absolute top-1 right-1 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button onclick="editLink(${index})" class="w-6 h-6 rounded bg-blue-500 hover:bg-blue-400 text-white text-xs flex items-center justify-center">âœï¸</button>
                            <button onclick="deleteLink(${index})" class="w-6 h-6 rounded bg-red-500 hover:bg-red-400 text-white text-xs flex items-center justify-center">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `).join('');
            }

            document.getElementById('linkCount').textContent = `${links.length} ä¸ªå‹é“¾`;
        }

        function editLink(index) {
            const link = siteData.friendLinks[index];
            document.getElementById('editLinkId').value = index;
            document.getElementById('editLinkName').value = link.name;
            document.getElementById('editLinkUrl').value = link.url;
            document.getElementById('editLinkModal').classList.remove('hidden');
        }

        function closeEditLinkModal() {
            document.getElementById('editLinkModal').classList.add('hidden');
        }

        document.getElementById('editLinkForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const index = parseInt(document.getElementById('editLinkId').value);
            siteData.friendLinks[index] = {
                ...siteData.friendLinks[index],
                name: document.getElementById('editLinkName').value,
                url: document.getElementById('editLinkUrl').value
            };
            saveToStorage();
            renderLinkList();
            closeEditLinkModal();
            showToast('å‹é“¾å·²æ›´æ–°');
        });

        function deleteLink(index) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå‹é“¾å—ï¼Ÿ')) return;
            siteData.friendLinks.splice(index, 1);
            saveToStorage();
            renderLinkList();
            updateStats();
            showToast('å‹é“¾å·²åˆ é™¤');
        }

        // ==================== ç»Ÿè®¡ ====================

        function updateStats() {
            const categories = ['common', 'tier1', 'tier2', 'stable', 'budget'];
            const totalSites = categories.reduce((sum, cat) => sum + (siteData[cat]?.length || 0), 0);
            const totalLinks = siteData.friendLinks?.length || 0;
            document.getElementById('statsInfo').textContent = `å…± ${totalSites} ä¸ªç½‘ç«™ Â· ${totalLinks} ä¸ªå‹é“¾`;
        }

        // ==================== å¯¼å…¥å¯¼å‡º ====================

        async function importFromScript() {
            try {
                const response = await fetch('script.js');
                const text = await response.text();

                const match = text.match(/const\s+(defaultSiteData|siteData)\s*=\s*(\{[\s\S]*?\n\};)/);
                if (!match) {
                    showToast('æ— æ³•è§£æ script.js ä¸­çš„æ•°æ®', 'error');
                    return;
                }

                const extractedData = new Function('return ' + match[2].slice(0, -1))();

                siteData = {
                    common: extractedData.common || [],
                    tier1: extractedData.tier1 || [],
                    tier2: extractedData.tier2 || [],
                    stable: extractedData.stable || [],
                    budget: extractedData.budget || [],
                    friendLinks: extractedData.friendLinks || []
                };

                saveToStorage();
                renderAll();
                showToast('æ•°æ®å¯¼å…¥æˆåŠŸï¼');
            } catch (error) {
                console.error('å¯¼å…¥å¤±è´¥:', error);
                showToast('å¯¼å…¥å¤±è´¥: ' + error.message, 'error');
            }
        }

        function exportToScript() {
            const generateSiteCode = (sites) => {
                if (!sites || sites.length === 0) return '[]';
                return '[\n' + sites.map(site => {
                    let code = `        {
            name: "${site.name}",
            desc: "${site.desc}",
            url: "${site.url}",
            domain: "${site.domain}",
            icon: "${site.icon}",`;
                    // åªæœ‰å½“iconUrlæœ‰å€¼æ—¶æ‰æ·»åŠ 
                    if (site.iconUrl) {
                        code += `
            iconUrl: "${site.iconUrl}",`;
                    }
                    code += `
            color: "${site.color}"
        }`;
                    return code;
                }).join(',\n') + '\n    ]';
            };

            const generateLinkCode = (links) => {
                if (!links || links.length === 0) return '[]';
                return '[\n' + links.map(link => `        { name: "${link.name}", url: "${link.url}" }`).join(',\n') + '\n    ]';
            };

            const siteDataCode = `// å¯¼èˆªç«™æ•°æ®
const siteData = {
    common: ${generateSiteCode(siteData.common)},
    tier1: ${generateSiteCode(siteData.tier1)},
    tier2: ${generateSiteCode(siteData.tier2)},
    stable: ${generateSiteCode(siteData.stable)},
    budget: ${generateSiteCode(siteData.budget)},
    friendLinks: ${generateLinkCode(siteData.friendLinks)}
};`;

            fetch('script.js')
                .then(r => r.text())
                .then(originalCode => {
                    const newCode = originalCode.replace(
                        /\/\/ å¯¼èˆªç«™æ•°æ®[\s\S]*?^};/m,
                        siteDataCode
                    );

                    const blob = new Blob([newCode], { type: 'text/javascript' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'script.js';
                    a.click();
                    URL.revokeObjectURL(url);

                    showToast('script.js å·²ç”Ÿæˆï¼Œè¯·æ›¿æ¢åŸæ–‡ä»¶');
                })
                .catch(error => {
                    console.error('å¯¼å‡ºå¤±è´¥:', error);
                    showToast('å¯¼å‡ºå¤±è´¥: ' + error.message, 'error');
                });
        }

        function downloadBackup() {
            const backup = {
                version: 1,
                exportTime: new Date().toISOString(),
                data: siteData
            };

            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `navsite-backup-${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);

            showToast('å¤‡ä»½å·²ä¸‹è½½');
        }

        function restoreBackup(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const backup = JSON.parse(e.target.result);
                    if (backup.data) {
                        siteData = backup.data;
                        saveToStorage();
                        renderAll();
                        showToast('å¤‡ä»½å·²æ¢å¤');
                    } else {
                        showToast('æ— æ•ˆçš„å¤‡ä»½æ–‡ä»¶', 'error');
                    }
                } catch (error) {
                    showToast('è§£æå¤‡ä»½å¤±è´¥', 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
        document.getElementById('editModal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) closeEditModal();
        });
        document.getElementById('editLinkModal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) closeEditLinkModal();
        });
        document.getElementById('linkCheckModal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) closeLinkCheckModal();
        });

        // ==================== é“¾æ¥æ£€æµ‹åŠŸèƒ½ï¼ˆå‚è€ƒOneNavä¼˜åŒ–ï¼‰ ====================

        let checkResults = [];
        let isChecking = false;
        const CONCURRENT_LIMIT = 5; // å¹¶å‘æ£€æµ‹æ•°é‡

        function openLinkCheckModal() {
            document.getElementById('linkCheckModal').classList.remove('hidden');
        }

        function closeLinkCheckModal() {
            document.getElementById('linkCheckModal').classList.add('hidden');
            isChecking = false;
        }

        // æ”¶é›†æ‰€æœ‰é“¾æ¥
        function collectAllLinks() {
            const links = [];
            const categories = ['common', 'tier1', 'tier2', 'stable', 'budget'];

            categories.forEach(category => {
                if (siteData[category]) {
                    siteData[category].forEach((site, index) => {
                        links.push({
                            category: categoryNames[category],
                            categoryKey: category,
                            index: index,
                            name: site.name,
                            url: site.url,
                            iconUrl: site.iconUrl || null
                        });
                    });
                }
            });

            // æ·»åŠ å‹é“¾
            if (siteData.friendLinks) {
                siteData.friendLinks.forEach((link, index) => {
                    links.push({
                        category: 'å‹æƒ…é“¾æ¥',
                        categoryKey: 'friendLinks',
                        index: index,
                        name: link.name,
                        url: link.url,
                        iconUrl: null
                    });
                });
            }

            return links;
        }

        // æ£€æµ‹å•ä¸ªé“¾æ¥ï¼ˆå¸¦CDNè¯†åˆ«ï¼‰
        async function checkSingleLink(url, timeout = 8000) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);

            // CDN/WAF å…³é”®è¯åˆ—è¡¨
            const cdnKeywords = ['cloudflare', 'akamai', 'cloudfront', 'fastly', 'cdn'];

            try {
                const response = await fetch(url, {
                    method: 'HEAD',
                    mode: 'no-cors',
                    signal: controller.signal
                });
                clearTimeout(timeoutId);

                // æ£€æŸ¥URLæ˜¯å¦åŒ…å«CDNå…³é”®è¯
                const urlLower = url.toLowerCase();
                for (const keyword of cdnKeywords) {
                    if (urlLower.includes(keyword)) {
                        return { status: 'unknown', message: 'å¯èƒ½æœ‰CDN' };
                    }
                }

                return { status: 'ok', message: 'å¯è®¿é—®' };
            } catch (error) {
                clearTimeout(timeoutId);
                if (error.name === 'AbortError') {
                    return { status: 'timeout', message: 'è¯·æ±‚è¶…æ—¶' };
                }
                // æŸäº› CORS é”™è¯¯å¯èƒ½æ˜¯å› ä¸º CDN/WAF é˜»æ­¢
                if (error.message && error.message.includes('CORS')) {
                    return { status: 'unknown', message: 'è·¨åŸŸé™åˆ¶' };
                }
                return { status: 'error', message: 'æ— æ³•è®¿é—®' };
            }
        }

        // æ£€æµ‹è‡ªå®šä¹‰å›¾æ ‡URL
        async function checkIconUrl(url) {
            return new Promise((resolve) => {
                const img = new Image();
                const timeout = setTimeout(() => {
                    resolve({ status: 'timeout', message: 'å›¾æ ‡åŠ è½½è¶…æ—¶' });
                }, 5000);

                img.onload = () => {
                    clearTimeout(timeout);
                    resolve({ status: 'ok', message: 'å›¾æ ‡æ­£å¸¸' });
                };
                img.onerror = () => {
                    clearTimeout(timeout);
                    resolve({ status: 'error', message: 'å›¾æ ‡æ— æ³•åŠ è½½' });
                };
                img.src = url;
            });
        }

        // å¹¶å‘æ£€æµ‹é“¾æ¥
        async function checkLinksInBatches(links, batchSize, onProgress) {
            const results = [];
            for (let i = 0; i < links.length; i += batchSize) {
                if (!isChecking) break;

                const batch = links.slice(i, i + batchSize);
                const batchPromises = batch.map(async (link) => {
                    const urlResult = await checkSingleLink(link.url);
                    let iconResult = null;
                    if (link.iconUrl) {
                        iconResult = await checkIconUrl(link.iconUrl);
                    }
                    return {
                        ...link,
                        urlStatus: urlResult.status,
                        urlMessage: urlResult.message,
                        iconStatus: iconResult ? iconResult.status : null,
                        iconMessage: iconResult ? iconResult.message : null
                    };
                });

                const batchResults = await Promise.all(batchPromises);
                results.push(...batchResults);

                // å›è°ƒè¿›åº¦
                if (onProgress) {
                    onProgress(results.length, links.length, batchResults);
                }
            }
            return results;
        }

        // å¼€å§‹æ£€æµ‹ï¼ˆä»æ¨¡æ€æ¡†å†…æŒ‰é’®è§¦å‘ï¼‰
        async function startLinkCheck() {
            if (isChecking) {
                showToast('æ­£åœ¨æ£€æµ‹ä¸­ï¼Œè¯·ç¨å€™', 'warning');
                return;
            }

            isChecking = true;
            checkResults = [];

            const links = collectAllLinks();
            const total = links.length;

            if (total === 0) {
                showToast('æ²¡æœ‰å¯æ£€æµ‹çš„é“¾æ¥', 'warning');
                isChecking = false;
                return;
            }

            // éšè—æç¤ºå’Œå¼€å§‹æŒ‰é’®
            document.getElementById('checkTips').classList.add('hidden');
            document.getElementById('btnStartCheck')?.parentElement?.remove();

            // é‡ç½®UI
            document.getElementById('checkProgressText').textContent = 'æ­£åœ¨æ£€æµ‹...';
            document.getElementById('checkProgressPercent').textContent = '0%';
            document.getElementById('checkProgressBar').style.width = '0%';
            document.getElementById('checkSummary').classList.add('hidden');
            document.getElementById('btnExportResults').classList.add('hidden');
            document.getElementById('btnShowProblems').classList.add('hidden');
            document.getElementById('checkResults').innerHTML = '';

            // å¹¶å‘æ£€æµ‹
            await checkLinksInBatches(links, CONCURRENT_LIMIT, (completed, total, batchResults) => {
                const percent = Math.round((completed / total) * 100);
                document.getElementById('checkProgressText').textContent = `æ­£åœ¨æ£€æµ‹ ${completed}/${total}...`;
                document.getElementById('checkProgressPercent').textContent = `${percent}%`;
                document.getElementById('checkProgressBar').style.width = `${percent}%`;
                document.getElementById('checkProgressInner').textContent = percent > 15 ? `${percent}%` : '';

                // æ·»åŠ æ‰¹é‡ç»“æœ
                batchResults.forEach(result => {
                    checkResults.push(result);
                    appendResultItem(result);
                });
            });

            // ç»Ÿè®¡
            const stats = {
                ok: checkResults.filter(r => r.urlStatus === 'ok').length,
                error: checkResults.filter(r => r.urlStatus === 'error').length,
                timeout: checkResults.filter(r => r.urlStatus === 'timeout').length,
                unknown: checkResults.filter(r => r.urlStatus === 'unknown').length
            };

            // æ˜¾ç¤ºç»Ÿè®¡æ‘˜è¦
            document.getElementById('checkProgressText').textContent = 'âœ… æ£€æµ‹å®Œæˆ';
            document.getElementById('countOk').textContent = stats.ok;
            document.getElementById('countError').textContent = stats.error;
            document.getElementById('countTimeout').textContent = stats.timeout;
            document.getElementById('countUnknown').textContent = stats.unknown;
            document.getElementById('countTotal').textContent = total;
            document.getElementById('checkSummary').classList.remove('hidden');
            document.getElementById('btnExportResults').classList.remove('hidden');

            // å¦‚æœæœ‰é—®é¢˜é“¾æ¥ï¼Œæ˜¾ç¤ºç­›é€‰æŒ‰é’®
            if (stats.error > 0 || stats.timeout > 0) {
                document.getElementById('btnShowProblems').classList.remove('hidden');
            }

            isChecking = false;

            // æç¤º
            const problemCount = stats.error + stats.timeout;
            if (problemCount > 0) {
                showToast(`æ£€æµ‹å®Œæˆï¼šå‘ç° ${problemCount} ä¸ªé—®é¢˜é“¾æ¥`, 'warning');
            } else {
                showToast('æ£€æµ‹å®Œæˆï¼šæ‰€æœ‰é“¾æ¥æ­£å¸¸', 'success');
            }
        }

        // ä»å·¥å…·æ æŒ‰é’®è§¦å‘ï¼ˆæ‰“å¼€æ¨¡æ€æ¡†ï¼‰
        function checkAllLinks() {
            openLinkCheckModal();
        }

        // ç­›é€‰ç»“æœ
        function filterResults(type) {
            const items = document.querySelectorAll('#checkResults > div');
            items.forEach(item => {
                const statusMatch = item.className.match(/bg-(green|red|yellow|cyan)-100/);
                const status = statusMatch ? {
                    'green': 'ok',
                    'red': 'error',
                    'yellow': 'timeout',
                    'cyan': 'unknown'
                }[statusMatch[1]] : null;

                if (type === 'all') {
                    item.style.display = '';
                } else if (type === 'problems') {
                    item.style.display = (status === 'error' || status === 'timeout') ? '' : 'none';
                } else {
                    item.style.display = (status === type) ? '' : 'none';
                }
            });
        }

        // æ·»åŠ ç»“æœé¡¹åˆ°åˆ—è¡¨
        function appendResultItem(result) {
            const container = document.getElementById('checkResults');

            const statusColors = {
                ok: 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300',
                error: 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300',
                timeout: 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300',
                unknown: 'bg-cyan-100 dark:bg-cyan-900/30 text-cyan-700 dark:text-cyan-300'
            };

            const statusIcons = {
                ok: 'âœ…',
                error: 'âŒ',
                timeout: 'â±ï¸',
                unknown: 'â“'
            };

            const iconWarning = result.iconStatus && result.iconStatus !== 'ok'
                ? `<span class="ml-2 text-orange-500" title="${result.iconMessage}">âš ï¸ å›¾æ ‡</span>`
                : '';

            const html = `
                <div class="flex items-center gap-3 p-3 rounded-lg ${statusColors[result.urlStatus]} border border-current/20">
                    <span class="text-lg">${statusIcons[result.urlStatus]}</span>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2 flex-wrap">
                            <span class="font-medium truncate max-w-[150px]">${result.name}</span>
                            <span class="text-xs opacity-70 px-1.5 py-0.5 rounded bg-white/50 dark:bg-black/20">${result.category}</span>
                            ${iconWarning}
                        </div>
                        <a href="${result.url}" target="_blank" class="text-xs opacity-70 truncate block hover:underline">${result.url}</a>
                    </div>
                    <span class="text-xs whitespace-nowrap font-medium">${result.urlMessage}</span>
                </div>
            `;

            container.insertAdjacentHTML('beforeend', html);
        }

        // å¯¼å‡ºæ£€æµ‹æŠ¥å‘Š
        function exportCheckResults() {
            if (checkResults.length === 0) {
                showToast('æ²¡æœ‰å¯å¯¼å‡ºçš„ç»“æœ', 'warning');
                return;
            }

            const now = new Date().toLocaleString('zh-CN');
            let report = `# é“¾æ¥æ£€æµ‹æŠ¥å‘Š\n\n`;
            report += `**æ£€æµ‹æ—¶é—´**ï¼š${now}\n`;
            report += `**æ€»è®¡**ï¼š${checkResults.length} ä¸ªé“¾æ¥\n\n`;

            // ç»Ÿè®¡
            const stats = {
                ok: checkResults.filter(r => r.urlStatus === 'ok').length,
                error: checkResults.filter(r => r.urlStatus === 'error').length,
                timeout: checkResults.filter(r => r.urlStatus === 'timeout').length,
                unknown: checkResults.filter(r => r.urlStatus === 'unknown').length
            };
            report += `## ğŸ“Š ç»Ÿè®¡æ‘˜è¦\n\n`;
            report += `| çŠ¶æ€ | æ•°é‡ |\n`;
            report += `|------|------|\n`;
            report += `| âœ… æ­£å¸¸ | ${stats.ok} |\n`;
            report += `| âŒ å¼‚å¸¸ | ${stats.error} |\n`;
            report += `| â±ï¸ è¶…æ—¶ | ${stats.timeout} |\n`;
            report += `| â“ æœªçŸ¥ | ${stats.unknown} |\n\n`;

            // é—®é¢˜é“¾æ¥
            const problems = checkResults.filter(r => r.urlStatus !== 'ok' && r.urlStatus !== 'unknown');
            if (problems.length > 0) {
                report += `## âš ï¸ é—®é¢˜é“¾æ¥ (${problems.length})\n\n`;
                problems.forEach(r => {
                    const icon = r.urlStatus === 'error' ? 'âŒ' : 'â±ï¸';
                    report += `### ${icon} ${r.name}\n`;
                    report += `- **åˆ†ç±»**: ${r.category}\n`;
                    report += `- **é“¾æ¥**: ${r.url}\n`;
                    report += `- **çŠ¶æ€**: ${r.urlMessage}\n`;
                    if (r.iconStatus && r.iconStatus !== 'ok') {
                        report += `- **å›¾æ ‡é—®é¢˜**: ${r.iconMessage}\n`;
                    }
                    report += `\n`;
                });
            }

            // å®Œæ•´åˆ—è¡¨
            report += `## ğŸ“‹ å®Œæ•´åˆ—è¡¨\n\n`;
            report += `| çŠ¶æ€ | åç§° | åˆ†ç±» | é“¾æ¥ |\n`;
            report += `|------|------|------|------|\n`;
            checkResults.forEach(r => {
                const icon = { ok: 'âœ…', error: 'âŒ', timeout: 'â±ï¸', unknown: 'â“' }[r.urlStatus];
                report += `| ${icon} | ${r.name} | ${r.category} | ${r.url} |\n`;
            });

            // ä¸‹è½½æ–‡ä»¶
            const blob = new Blob([report], { type: 'text/markdown;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `link-check-report-${new Date().toISOString().slice(0, 10)}.md`;
            a.click();
            URL.revokeObjectURL(url);

            showToast('æŠ¥å‘Šå·²ä¸‹è½½');
        }
    </script>
</body>

</html>